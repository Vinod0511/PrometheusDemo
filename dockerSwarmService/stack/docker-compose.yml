version: '3.4'
services:
  prometheus:
    image: prom/prometheus 
    volumes: 
      - prometheus-data:/prometheus/data
    configs:
      - source: prometheus.yml
        target: /etc/prometheus/prometheus.yml
    ports:
      - "9090:9090"
  alertmanager:
    image: "prom/alertmanager:v0.15.0"
    configs:
      - source: alertmanager.yml
        target: /etc/alertmanager/alertmanager.yml
    ports:
      - 9093:9093
    volumes:
      - alertmanager-data:/alertmanager
  grafana:
    image: grafana/grafana    
    volumes: 
      - grafana-data:/var/lib/grafana
    ports:
      - "3000:3000"
  file-handler: 
    image: dockerswarmservice_file-handler:latest
    environment:    
      - NODE_ENV=production
      - port=5672
      - adminPort=15672
      - hostname=rabbit 
    container_name: file-handler
    hostname: "file-handler"
    ports: 
      - 3401:3401 
  rabbit:
    image: "rabbitmq:3-management-alpine"
    hostname: "rabbit"
    container_name: rabbit2
    environment:
      RABBITMQ_ERLANG_COOKIE: "SWQOKODSQALRPCLNMEQG"
      RABBITMQ_DEFAULT_USER: "rabbitmq"
      RABBITMQ_DEFAULT_PASS: "rabbitmq"
      RABBITMQ_DEFAULT_VHOST: "dev_local"
    ports:
      - "15671:15672"
      - "5671:5672"
    volumes: 
      - rabbit-data:/var/lib/rabbitmq/mnesia          

volumes:
  grafana-data:  
  rabbit-data:
configs:
  prometheus.yml:
    external: true